---
import BaseLayout from "@/layouts/BaseLayout.astro";
import { Icon } from "astro-icon/components";
import ProjectCard from "@/components/mdx/ProjectCard.astro";
import ProjectEditor from "@/components/ProjectEditor";
import projectsData from "@/data/projects.json";
import Pagination from "@/components/widgets/Pagination.astro";
import { generatePageLinks } from "@utils/blogUtils";

import type { Page } from "astro";

interface Project {
  name: string;
  avatar: string;
  description: string;
  url: string;
  badge?: string;
}

interface Props {
  page: Page<Project>;
}

export async function getStaticPaths({ paginate }: { paginate: any }) {
  return paginate(projectsData, { pageSize: 15 });
}

const { page } = Astro.props as Props;
const totalPages = Math.ceil(page.total / page.size);
const pageLinks = generatePageLinks(totalPages);

const projects = page.data;
---

<BaseLayout title="Projects" isIndexed={false}>
  
  <div class="mb-10 animate-fade-in-up">
    <h1 class="text-3xl md:text-4xl font-bold mb-4 flex items-center gap-3">
      <Icon name="lucide:folder-git-2" class="text-primary" />
      <span>My Projects</span>
    </h1>
    <p class="text-base-content/70 text-lg">
      这里展示了我的一些个人项目、工具和实验性作品。
    </p>

    <div class="relative max-w-2xl mr-auto mt-4 mb-8 flex gap-2 items-center">
      <div class="relative group flex-1">
        <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
          <Icon name="lucide:search" class="h-5 w-5 text-base-content/40 group-focus-within:text-primary transition-colors" />
        </div>
        <input
          type="text"
          id="project-search-input"
          class="block w-full pl-11 pr-4 py-3 bg-base-100 border-none rounded-2xl text-base-content placeholder-base-content/40 focus:ring-2 focus:ring-primary/50 focus:bg-base-100 shadow-sm transition-all duration-300"
          placeholder="搜索项目..."
        />
      </div>
      <ProjectEditor client:only="react" />
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6" id="projects-grid">
      {projects.map((project) => (
        <div class="project-item" data-name={project.name.toLowerCase()} data-desc={project.description.toLowerCase()}>
          <ProjectCard
            name={project.name}
            avatar={project.avatar}
            description={project.description}
            url={project.url}
            badge={project.badge}
          />
        </div>
      ))}
    </div>
  </div>

  <div class="mt-12">
    <Pagination page={page} totalPages={totalPages} pageLinks={pageLinks} baseUrl="/project" />
  </div>


</BaseLayout>

<script>
  document.addEventListener('astro:page-load', () => {
    const searchInput = document.getElementById('project-search-input');
    const projectItems = document.querySelectorAll('.project-item');

    if (searchInput) {
      searchInput.addEventListener('input', (e) => {
        const term = (e.target as HTMLInputElement).value.toLowerCase();
        
        projectItems.forEach((item) => {
          const name = (item as HTMLElement).dataset.name || '';
          const desc = (item as HTMLElement).dataset.desc || '';
          
          if (name.includes(term) || desc.includes(term)) {
            (item as HTMLElement).style.display = '';
          } else {
            (item as HTMLElement).style.display = 'none';
          }
        });
      });
    }
  });
</script>
