---
interface Props {
  envId: string;
}

import Card from "@/components/temple/Card.astro";
import "@/styles/twikoo.css";
const { envId } = Astro.props;
---

<Card class="p-6">
  <div id="tcomment"></div>
</Card>

<script is:inline defer src="/js/twikoo.all.min.js"></script>

<script is:inline define:vars={{ envId }}>
  function initTwikoo() {
    const container = document.getElementById('tcomment');
    if (!container || container.classList.contains('twikoo-init')) return;

    if (typeof twikoo !== 'undefined') {
      twikoo.init({
        envId: envId,
        el: '#tcomment',
      });
      container.classList.add('twikoo-init');
    }
  }

  // 视图转换兼容 - 移除 once: true，通过 class 防止重复初始化
  // 初始加载时初始化
  initTwikoo();
  
  // swup 页面切换后重新初始化
  document.addEventListener('swup:contentReplaced', initTwikoo);
</script>


